%\chapter{Введение в полулагранжевые методы для потоков геофизического масштаба} \label{chapt0}
\chapter*{Глава 1} \label{chapt1}

\section*{Введение} \label{sect1_1}
Полулагражевый метод это метод численного решения уравнений в частных производных, которые описывают процесс переноса. Данный метод учитывает Лагранжевую природу процесса переноса, но, в тоже время, он позволяет работать на фиксированной вычислительной сетке. Взяв за начало первые предложения в метеорологической литературе, которые фокусировались на переносе вихря в упрощенных моделях крупномасштабного потока, метод трансформировался в законченый метод дискретизации для полных уравнений атмосферных потоков. Полулагржевый метод также связан (а, в некоторых случаях, полностью эквивалентен) с аналогичными методами, разработанными в других сферах моделирования, такими как, например, модифицированный метод характеристик, метод Эйлера-Лангранжа и харатеристический метод Галеркина. 

Исчерпывающий обзор полулагранжевого метода в метеорологической литературе до 1990 года предствален в [67]. Обзоры разработок, посвященных смежным методам в других областях моделирования, могут быть найдены, например, в [15], [43], [56].

Краткое описание данной вводной статьи представлено ниже. В разделе 2 представлена базовая концепция полулугранжевого метода, а также простейшие положения для линейного одномерного уравнения переноса. Кроме того, описаны разница и связь с сугубо лагранжевыми методами. В разделе 3, в ключе классического метео масштабного анализа, рассмотрена особая роль процесса переноса для крупномасштабного атмосферного потока. В разделе 4 кратко освещен процесс разработки полулагражевых методов вкупе с некоторыми паралелльными разработками в других научных сферах. В разделе 5 описаны некоторые из возможных способов реализации ключевых этапов в полулуагранжевом методе. В разделе 6 представлены результаты простых численных тестов для одномерного и двумерного случая изолированного (passive) переноса с целью показать как метод может быть реализован на практике. Затем, результаты сравниваются с аналогичными элеровыми схемами. В разделе 7 будет обсуждена устойчивость и сходимость метода.

Первая версия данного обзора полулагранжевых методов была осуществлена, благодаря приглашению на семинар по прикладной математике на ETH Zurich, чтобы прочитать серию докладов по данной тематике в рамках программы ERCOFTAC в июле 2004. Я хотел бы поблагодарить профессоров Рольфа Джелтча (Rolf Jeltsch) и Виллиям Сойер (William Sawyer) за поддержку этого начинания и базовую концепцию данного обзора.

Мой первый персональный опыт работы с полулагражевыми методами был получен в 1993 году в ходе моей работы над кандидатской диссертацией под руководством профессора Винчензо Касулли (Vincenzo Casulli, University of Trento, Italy). Я хотел бы поблагодарить его за мое посвящение как и в данную восхитительную область, так и в мир численного моделирования реального мира. Всевозможные обсуждения с доктором Эндрю Станифорт (Andrew Staniforth, Met Office, UK) также были весьма важны в рамках углубления моего понимания данных методов и численных проблем численного прогнозирования погоды в целом.

Мой опыт с полулагранжевыми методами также был углублен, благодаря обсуждениям и помощи моих многих друзей и коллег. Я хотел бы поблагодарить их всех за помошь и советы.

\newpage
%============================================================================================================================

\chapter*{Глава 2} \label{chapt_2}
\section*{Полулагранжевый метод для линейого уравнения переноса} \label{sect1_2}
Для того, чтобы познакомиться с полулагранжевым методом в простом контексте, рассмотрим одномерное линейное уравнение переноса
%
\begin{equation}
\label{eq:equation2_1}
\frac{\partial c}{\partial t} + u\frac{\partial c}{\partial x} = 0
\end{equation}
%
с постоянным коэфициентом $u$ и с начальными данными $c_0(x), x\in{\mathbf{R}}$. Общеизвестно, что
%
\begin{equation}
\label{eq:equation2_2}
c(c,t)=c_0(x - ut)
\end{equation}
%
Теперь рассмотрим дискретизацию уравнения \ref{eq:equation2_1} на равномерной одномерной сетке с шагом по пространству $\Delta x$ и временным шагом $\Delta t$. Обозначим узлы сетки как $i$, а дискретные временные уровни как $n$. Тогда пространсвенно-временные позиции на сетке могут быть обозначены $x_i=i\Delta{x}$, $t^n=n\Delta{t}$, а приближенные значения, вычисленные при помощи численного решения, как $c^n\approx c(x_i, t^n)$. Стандартные конечно-разностные методы основаны на аппроксимации дифференциальных операторов конечно-разностными приращениями. Рассмотрим некоторые типовые примеры. Одним из наиболее простых методов является противопотоковый метод, в котором для аппроксимации использются односторонние конечно-разностные приращения

%
\begin{equation}
\label{eq:equation2_3}
\frac{c_i^{n+1}-c_i^n}{\Delta t} + u\frac{c_i^n-c_{i-1}^{n}}{\Delta x} = 0
\end{equation}
%
Здесь предполагается, что $u\ge0$, а направление задано положительно (Here, it was assumed that u>=0 and the direction). Противопотоковый метод обладает первым порядоком аппроксимации по времени и пространству. Информация о противопотоковых методах высокого порядка представлена, например, в [12]. Метод с перешагиванием использует центральные конечные разности по времени и пространству
%
\begin{equation}
\label{eq:equation2_4}
\frac{c_i^{n+1}-c_i^{n-1}}{2\Delta t} + u\frac{c_{i+1}^n-c_{i-1}^{n}}{2\Delta x} = 0
\end{equation}
%
Итоговый метод имеет второй порядок аппроксимации по пространству и времени. Применение более точной аппроксимации пространственной производной может дать высокоточные схемы по пространству и времени. Например, взяв центральные разности по времени и аппроксимацию четвертого порядка производной по $x$ (например, см. [14]), получим
%
\begin{equation}
\label{eq:equation2_5}
\frac{c_i^{n+1}-c_i^{n-1}}{2\Delta t} + u\Big[\frac{4}{3}\frac{c_{i+1}^n-c_{i-1}^n}{2\Delta x}-\frac{1}{3}\frac{c_{i+2}^n-c_{i-2}^n}{4\Delta x}\Big] = 0.
\end{equation}
%
Упомянутые методы являются трехшаговыми по времени, потому требуют использования особой аппроксимации для вычисления первого шага по времени. Примером двухшагового по времени метода, который имеет второй порядок аппроксимации, является метод Лакса"--~Вендроффа
%
\begin{equation}
\label{eq:equation2_6}
\frac{c_i^{n+1}-c_i^n}{\Delta t} + u\frac{c_i^n-c_{i-1}^n}{2\Delta x} - \frac{u^2\Delta t}{2}\frac{c_{i+1}^n-2c_i^n+c_{i-1}^n}{\Delta x^2} = 0,
\end{equation}
%
который может быть  интерпретирован как устойчивая версия (неустойчивой) схемы
%
\begin{equation}
\label{eq:equation2_7}
\frac{c_i^{n+1}-c_i^n}{\Delta t} + u\frac{c_{i+1}^n-c_{i-1}^n}{2\Delta x} = 0,
\end{equation}
%
полученной добавлением численной диссипации в особом виде (например, см. [56]). Общеизвестно, что устойчивость этих методов зависит в основном от параметра $C=u\Delta t/\Delta x$, также известного как число Куранта. Основное условие для устойчивости это, фактически, $C\le1$, которое также известно как условие Куранта"--~Фридрихса"--~Леви (КФЛ) (см. [10]).

Лагранжевые и полулагранжевые методы, в свою очередь, используют характерную особенность уравнения переноса, а именно представление точного решения в терминах начального параметра. В частности, рассмотрев без потери общности случай $u\ge0$, можно обнаружить, что имеют место два следующих уравнения
%
\begin{equation}
\label{eq:equation2_8}
\begin{split}
c (x_i, t^n) & = c_0(x_i - un\Delta t) {} \\
		     & {} = c_0(x_i + u\Delta t - u(n+1)\Delta t) = c(x_i + u\Delta t, t^{n+1})
\end{split}
\end{equation}
%
%
\begin{equation}
\label{eq:equation2_9}
\begin{split}
c (x_i, t^{n+1}) & = c_0(x_i - u(n+1)\Delta t) {} \\
& {} = c_0(x_i - u\Delta t - un\Delta t) = c(x_i - u\Delta t, t^{n})
\end{split}
\end{equation}
%
Уравнение \ref{eq:equation2_9} является основой для чистых лагранжевых методов. Особая природа точного решения уравнения \ref{eq:equation2_1} позволяет использовать информацию о решении в точке сетки в момент $n$ , чтобы вывести значение решения в момент времени $n+1$ в точках сетки, которые \textit{переместились с потоком}. В результате того, что сетка должна быть изменена на каждом временном шаге, практическое приложение лагранжевых методов неэффективно и данные методики никогда не становились действующими инструментами в прогнозе погоды или крупномасштабных атмосферных симуляциях.

Уравнение \ref{eq:equation2_10} обеспечивает основу для полулугранжевого метода. Вновь используется особая природа точного решения \ref{eq:equation2_1}, чтобы выразить значение решения в узлах сетки на временом шаге $n+1$ в терминах значений решения на слое $n$ в тех узлах сетки, которые \textit{будут перенесены потоком} на вычислительную сетку за один временной шаг.
Тот факт, что сетка не изменяется во времени, имеет практическое преимущество, которое является одной из фундаментальных причин для гораздо более широкого использования полулагранжевых методов, нежели чисто лагранжевых. Дискретное определение полулагранжевого метода может быть получено из уравнения \ref{eq:equation2_10} как
%
\begin{equation}
\label{eq:equation2_10}
c_i^{n+1} = c_{i-u\frac{\Delta t}{\Delta x}}^{n} = c_{i-k-\alpha}^n \quad u\frac{\Delta t}{\Delta x} = k + \alpha \quad k = \Big[u\frac{\Delta t}{\Delta x}\Big].
\end{equation}
%

$k$ and $\alpha$ часто называют целым и дробным числами Куранта, соответственно. Выражение $c_{i-k-\alpha}^n$ может быть интерпретировано как значение, полученное из приближенных значений $c^n$ в точке в точке $i\Delta x - u\Delta t$ с использованием некоторой интерполяционной процедуры. Применив линейную интерполяцию, можно сразу получить два интересных факта
%
\begin{equation}
\label{eq:equation2_11}
c_i^{n+1} = \alpha c_{i-k-1}^{n} + (1-\alpha)c_{i-k}^n.
\end{equation}
%
Во первых, если $C = u\Delta t/\Delta x < 1$, тогда имеем в \ref{eq:equation2_11} $k=0$, $C=\alpha$ и  легко увидеть, что итоговый метод идентичен противопотоковому методу \ref{eq:equation2_3}. Более того,
ясно, что \ref{eq:equation2_11} выполняется для любого значения числа Куранта и что, поскольку значения решения на новом временом слое $n+1$ получены с использованием линейной интерполяции значений на временом слое $n$ с неотрицательными коэффициентами, выполняется дискретный принцип максимума, т. е.
%
\begin{equation}
\label{eq:equation2_12}
\min_i c_i^0 \le \min_i c_i^n \le \max_i c_i^n \le \max_i c_i^0
\end{equation}
%
для любого $n$. Это также подразумевает устойчивость в максимальной норме для произвольного числа Куранта. Таким образом, по крайней мере, в простом случае полулагранжевый метод, как видимо, имеет большое преимущество над рассмотренными ранее эйлеровыми методами, поскольку отсутсвует условие стабильности, ограничивающее выбор временного шага.

Полулагранжевый метод может быть легко обобщен на многомерный случай. Рассмотрим поле постоянных скоростей $\mathbf{u}\in\mathbf{R}^d$ и начальное условие $c_0(x), x\in\mathbf{R}^d$. Тогда многомерное линейное уравнение адвекции имеет вид
%
\begin{equation}
\label{eq:equation2_13}
\frac{\partial{c}}{\partial{t}} + \mathbf{u} \cdot \nabla c = 0.
\end{equation}
%
Как и в одномерном случае, аналитическое решение представимо в виде
%
\begin{equation}
\label{eq:equation2_14}
c(\mathbf{x}, t) = c_0(\mathbf{x} - \mathbf{u}t),
\end{equation}
%
и полулагражевый метод может быть выведен как и в одномерном случае, лишь заменив одномерную интерполяцию на многомерную.
	
В более общем случае, когда поле скоростей $\mathbf{u} (\mathbf{x},t)\in\mathbf{R}^d$ зависит от простанства и времени, имеем
%
\begin{equation}
\label{eq:equation2_15}
\frac{dc}{dt}=\frac{\partial{c}}{\partial{t}} + \mathbf{u}(\mathbf{x}, t) \cdot \nabla c = 0.
\end{equation}
%
Здесь была введена обычная запись $dc/dt$ для обозначения лагранжевой производной. Полагая, для поля скоростей верны некоторые предположения о непрерывности (оно должно быть непрерывным по Липшицу, например, см. [56]), можно доказать, что существует функция линий тока или характеристическая функция. Они опеределены как решения $\mathbf{X}(t;s,\mathbf{x})$ обыкновенных дифференциальных уравнений
%
\begin{equation}
\label{eq:equation2_16}
\frac{d}{dt}\mathbf{X}(t;s,\mathbf{x})=\mathbf{u}(\mathbf{X}(t; s, \mathbf{x}), t)
\end{equation}
%
с начальным условием в момент времени $s$, заданным как $\mathbf{X}(t;s,\mathbf{x})=\mathbf{x}$. Для гладких начальных данных, по цепному правилу доказуемо, что
%
\begin{equation}
\label{eq:equation2_17}
c(\mathbf{x}, t) = c_0(\mathbf{X}(0;t,\mathbf{x})).
\end{equation}
%
Это показывает, что аналогичное доказательство, как вышеупомянутое, выполняется для численного метода основанного на полугагражевом подходе, однако при условии, что получено численное решение уравнения \ref{eq:equation2_16}. Таким образом, подводя итог, можно сказать, что, используя представленную формулу \ref{eq:equation2_17}, полулагранжевые методы уменьшают аппроксимацию уравнения переноса \ref{eq:equation2_15} до следующих ключевых шагов:
\begin{itemize}
	\item на заданом слое по времени $n$, для каждой точки сетки $x$ вычислить приближенное решение \ref{eq:equation2_16} для определения оценти $\mathbf{X}*(t^n;t^{n+1}, \mathbf{x})$
	\item вычислить аппроксимацию уравнения \ref{eq:equation2_17} путем интерполяции значений в узлах сетки на временом слое $n$ в точках $\mathbf{X}*(t^n;t^{n+1}, \mathbf{x})$.
\end{itemize}
Это подразумевает что решение ДУЧП \ref{eq:equation2_15} сведено к решению большого набора взаимно независимых ОДУ и к осуществелению многомерное интерполяции. Для каждого из этих шагов, доступен ряд классических и хорошо изученных методов.
%\newpage
%============================================================================================================================

\section{Ссылки} \label{sect1_2}
Сошлёмся на библиографию. Одна ссылка: \cite[с.~54]{Sokolov}\cite[с.~36]{Gaidaenko}. Две ссылки: \cite{Sokolov,Gaidaenko}. Много ссылок:  \cite[с.~54]{Lermontov,Management,Borozda} \cite{Lermontov,Management,Borozda,Marketing,Constitution,FamilyCode,Gost.7.0.53,Razumovski,Lagkueva,Pokrovski,Sirotko,Lukina,Methodology,Encyclopedia,Nasirova,Berestova,Kriger}. И ещё немного ссылок: \cite{Article,Book,Booklet,Conference,Inbook,Incollection,Manual,Mastersthesis,Misc,Phdthesis,Proceedings,Techreport,Unpublished}. \cite{medvedev2006jelektronnye, CEAT:CEAT581, doi:10.1080/01932691.2010.513279,Gosele1999161,Li2007StressAnalysis, Shoji199895,test:eisner-sample,AB_patent_Pomerantz_1968,iofis_patent1960}

%Попытка реализовать несколько ссылок на конкретные страницы для стандартной реализации:[\citenum{Sokolov}, с.~54; \citenum{Gaidaenko}, с.~36].

%Несколько источников мультицитата \cites[vii--x, 5, 7]{Sokolov}[v--x, 25, 526]{Gaidaenko} поехали дальше

Ссылки на собственные работы:~\cite{vakbib1, confbib1}

Сошлёмся на приложения: Приложение \ref{AppendixA}, Приложение \ref{AppendixB2}.

Сошлёмся на формулу: формула \eqref{eq:equation1}.

Сошлёмся на изображение: рисунок \ref{img:knuth}.

%\newpage
%============================================================================================================================

\section{Формулы} \label{sect1_3}

Благодаря пакету \textit{icomma}, \LaTeX~одинаково хорошо воспринимает в качестве десятичного разделителя и запятую ($3,1415$), и точку ($3.1415$).

\subsection{Ненумерованные одиночные формулы} \label{subsect1_3_1}

Вот так может выглядеть формула, которую необходимо вставить в строку по тексту: $x \approx \sin x$ при $x \to 0$.

А вот так выглядит ненумерованая отдельностоящая формула c подстрочными и надстрочными индексами:
\[
(x_1+x_2)^2 = x_1^2 + 2 x_1 x_2 + x_2^2
\]

При использовании дробей формулы могут получаться очень высокие:
\[
\frac{1}{\sqrt{2}+
	\displaystyle\frac{1}{\sqrt{2}+
		\displaystyle\frac{1}{\sqrt{2}+\cdots}}}
\]

В формулах можно использовать греческие буквы:
\[
\alpha\beta\gamma\delta\epsilon\varepsilon\zeta\eta\theta\vartheta\iota\kappa\lambda\\mu\nu\xi\pi\varpi\rho\varrho\sigma\varsigma\tau\upsilon\phi\varphi\chi\psi\omega\Gamma\Delta\Theta\Lambda\Xi\Pi\Sigma\Upsilon\Phi\Psi\Omega
\]

\def\slantfrac#1#2{ \hspace{3pt}\!^{#1}\!\!\hspace{1pt}/
	\hspace{2pt}\!\!_{#2}\!\hspace{3pt}
} %Макрос для красивых дробей в строчку (например, 1/2)
Для красивых дробей (например, в индексах) можно добавить макрос
\verb+\slantfrac+ и писать $\slantfrac{1}{2}$ вместо $1/2$.
%\newpage
%============================================================================================================================

\subsection{Ненумерованные многострочные формулы} \label{subsect1_3_2}

Вот так можно написать две формулы, не нумеруя их, чтобы знаки равно были строго друг под другом:
\begin{align}
	f_W & =  \min \left( 1, \max \left( 0, \frac{W_{soil} / W_{max}}{W_{crit}} \right)  \right), \nonumber \\
	f_T & =  \min \left( 1, \max \left( 0, \frac{T_s / T_{melt}}{T_{crit}} \right)  \right), \nonumber
\end{align}

Выровнять систему ещё и по переменной $ x $ можно, используя окружение \verb|alignedat| из пакета \verb|amsmath|. Вот так: 
\[
|x| = \left\{
\begin{alignedat}{2}
&&x, \quad &\text{eсли } x\geqslant 0 \\
&-&x, \quad & \text{eсли } x<0
\end{alignedat}
\right.
\]
Здесь первый амперсанд (в исходном \LaTeX описании формулы) означает выравнивание по~левому краю, второй "--- по~$ x $, а~третий "--- по~слову <<если>>. Команда \verb|\quad| делает большой горизонтальный пробел.

Ещё вариант:
\[
|x|=
\begin{cases}
\phantom{-}x, \text{если } x \geqslant 0 \\
-x, \text{если } x<0
\end{cases}
\]

Кроме того, для  нумерованых формул \verb|alignedat|  делает вертикальное
выравнивание номера формулы по центру формулы. Например,  выравнивание компонент вектора:
\begin{equation}
\label{eq:2p3}
\begin{alignedat}{2}
{\mathbf{N}}_{o1n}^{(j)} = \,{\sin} \phi\,n\!\left(n+1\right)
{\sin}\theta\,
\pi_n\!\left({\cos} \theta\right)
\frac{
	z_n^{(j)}\!\left( \rho \right)
}{\rho}\,
&{\boldsymbol{\hat{\mathrm e}}}_{r}\,+   \\
+\,
{\sin} \phi\,
\tau_n\!\left({\cos} \theta\right)
\frac{
	\left[\rho z_n^{(j)}\!\left( \rho \right)\right]^{\prime}
}{\rho}\,
&{\boldsymbol{\hat{\mathrm e}}}_{\theta}\,+   \\
+\,
{\cos} \phi\,
\pi_n\!\left({\cos} \theta\right)
\frac{
	\left[\rho z_n^{(j)}\!\left( \rho \right)\right]^{\prime}
}{\rho}\,
&{\boldsymbol{\hat{\mathrm e}}}_{\phi}\:.
\end{alignedat}
\end{equation}

Ещё об отступах. Иногда для лучшей <<читаемости>> формул полезно
немного исправить стандартные интервалы \LaTeX с учётом логической
структуры самой формулы. Например в формуле~\ref{eq:2p3} добавлен
небольшой отступ \verb+\,+ между основными сомножителями, ниже
результат применения всех вариантов отступа:
\begin{align*}
	\backslash! &\quad f(x) = x^2\! +3x\! +2 \\
	\mbox{по-умолчанию} &\quad f(x) = x^2+3x+2 \\
	\backslash, &\quad f(x) = x^2\, +3x\, +2 \\
	\backslash{:} &\quad f(x) = x^2\: +3x\: +2 \\
	\backslash; &\quad f(x) = x^2\; +3x\; +2 \\
	\backslash \mbox{space} &\quad f(x) = x^2\ +3x\ +2 \\
	\backslash \mbox{quad} &\quad f(x) = x^2\quad +3x\quad +2 \\
	\backslash \mbox{qquad} &\quad f(x) = x^2\qquad +3x\qquad +2
\end{align*}


Можно использовать разные математические алфавиты:
\begin{align}
	\mathcal{ABCDEFGHIJKLMNOPQRSTUVWXYZ} \nonumber \\
	\mathfrak{ABCDEFGHIJKLMNOPQRSTUVWXYZ} \nonumber \\
	\mathbb{ABCDEFGHIJKLMNOPQRSTUVWXYZ} \nonumber
\end{align}

Посмотрим на систему уравнений на примере аттрактора Лоренца:

\[ 
\left\{
\begin{array}{rl}
\dot x = & \sigma (y-x) \\
\dot y = & x (r - z) - y \\
\dot z = & xy - bz
\end{array}
\right.
\]

А для вёрстки матриц удобно использовать многоточия:
\[ 
\left(
\begin{array}{ccc}
a_{11} & \ldots & a_{1n} \\
\vdots & \ddots & \vdots \\
a_{n1} & \ldots & a_{nn} \\
\end{array}
\right)
\]


%\newpage
%============================================================================================================================
\subsection{Нумерованные формулы} \label{subsect1_3_3}

А вот так пишется нумерованая формула:
\begin{equation}
\label{eq:equation1}
e = \lim_{n \to \infty} \left( 1+\frac{1}{n} \right) ^n
\end{equation}

Нумерованых формул может быть несколько:
\begin{equation}
\label{eq:equation2}
\lim_{n \to \infty} \sum_{k=1}^n \frac{1}{k^2} = \frac{\pi^2}{6}
\end{equation}

Впоследствии на формулы (\ref{eq:equation1}) и (\ref{eq:equation2}) можно ссылаться.

Сделать так, чтобы номер формулы стоял напротив средней строки, можно, используя окружение \verb|multlined| (пакет \verb|mathtools|) вместо \verb|multline| внутри окружения \verb|equation|. Вот так:
\begin{equation} % \tag{S} % tag - вписывает свой текст 
\label{eq:equation3}
\begin{multlined}
1+ 2+3+4+5+6+7+\dots + \\ 
+ 50+51+52+53+54+55+56+57 + \dots + \\ 
+ 96+97+98+99+100=5050 
\end{multlined}
\end{equation}

Используя команду \verb|\labelcref| из пакета \verb|cleveref|, можно
красиво ссылаться сразу на несколько формул
(\labelcref{eq:equation1,eq:equation3,eq:equation2}), даже перепутав
порядок ссылок \verb|(\labelcref{eq:equation1,eq:equation3,eq:equation2})|.
