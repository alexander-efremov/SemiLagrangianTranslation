%\chapter{Введение в полулагранжевые методы для потоков геофизического масштаба} \label{chapt0}
\chapter*{Глава 1. Введение} \label{chapt1}

Полулагранжевый метод является способом численного решения уравнений в частных производных, которые описывают процесс переноса. Данный метод учитывает лагранжевую природу процесса переноса, однако в тоже время, позволяет работать на фиксированной вычислительной сетке. Взяв за начало первые предложения в метеорологической литературе, которые фокусировались на переносе вихря в упрощенных моделях крупномасштабного потока, метод трансформировался в законченный метод дискретизации для полных уравнений атмосферных потоков. Полулагранжевый метод также связан (а, в некоторых случаях, полностью эквивалентен) с аналогичными методами, разработанными в других сферах моделирования, такими как, например, модифицированный метод характеристик, метод Эйлера-Лагранжа и характеристический метод Галеркина. 

Исчерпывающий обзор полулагранжевого метода в метеорологической литературе до 1990 года представлен в [67]. Обзоры разработок, посвященных смежным методам в других областях моделирования, могут быть найдены, например, в [15], [43], [56].

Краткое описание данной вводной статьи представлено ниже. В разделе 2 представлена базовая концепция полулагранжевого метода, а также простейшие положения для линейного одномерного уравнения переноса. Кроме того, описаны разница и связь с сугубо лагранжевыми методами. В разделе 3, в ключе классического метео масштабного анализа, рассмотрена особая роль процесса переноса для крупномасштабного атмосферного потока. В разделе 4 кратко освещен процесс разработки полулагранжевых методов вкупе с некоторыми параллельными разработками в других научных сферах. В разделе 5 описаны некоторые из возможных способов реализации ключевых этапов в полулагранжевом методе. В разделе 6 представлены результаты простых численных тестов для одномерного и двумерного случая изолированного (passive) переноса с целью показать как метод может быть реализован на практике. Затем, результаты сравниваются с аналогичными эйлеровыми схемами. В разделе 7 обсуждается устойчивость и сходимость метода.

Первая версия данного обзора полулагранжевых методов была осуществлена, благодаря приглашению на семинар по прикладной математике на ETH Zurich, чтобы прочитать серию докладов по данной тематике в рамках программы ERCOFTAC в июле 2004. Я хотел бы поблагодарить профессоров Рольфа Джелтча (Rolf Jeltsch) и Уильяма Сойера (William Sawyer) за поддержку этого начинания и базовую концепцию данного обзора.

Мой первый персональный опыт работы с полулагранжевыми методами был получен в 1993 году в ходе моей работы над кандидатской диссертацией под руководством профессора Винчензо Касулли (Vincenzo Casulli, University of Trento, Italy). Я хотел бы поблагодарить его за мое посвящение как в данную восхитительную область, так и в мир практического численного моделирования. Всевозможные обсуждения с доктором Эндрю Станифортом (Andrew Staniforth, Met Office, UK) также были весьма важны в рамках углубления моего понимания обозначенных методов и проблем численного прогнозирования погоды в целом.

Мой опыт с полулагранжевыми методами также был углублен, благодаря обсуждениям и помощи моих многих друзей и коллег. Я хотел бы поблагодарить их всех за помощь и советы.

\newpage
%============================================================================================================================

\chapter*{Глава 2. Полулагранжевый метод для линейного уравнения переноса} \label{chapt_2}
Для того, чтобы познакомиться с полулагранжевым методом в простом контексте, рассмотрим одномерное линейное уравнение переноса
%
\begin{equation}
\label{eq:equation2_1}
\frac{\partial c}{\partial t} + u\frac{\partial c}{\partial x} = 0
\end{equation}
%
с постоянным коэффициентом $u$ и с начальными данными $c_0(x), x\in{\mathbf{R}}$. Общеизвестно, что
%
\begin{equation}
\label{eq:equation2_2}
c(c,t)=c_0(x - ut)
\end{equation}
%
Теперь рассмотрим дискретизацию уравнения \eqref{eq:equation2_1} на равномерной одномерной сетке с шагом по пространству $\Delta x$ и временным шагом $\Delta t$. Обозначим узлы сетки как $i$, а дискретные временные уровни как $n$. Тогда пространственно-временные позиции на сетке могут быть обозначены $x_i=i\Delta{x}$, $t^n=n\Delta{t}$, а приближенные значения, вычисленные при помощи численного решения, как $c^n\approx c(x_i, t^n)$. Стандартные конечно-разностные методы основаны на аппроксимации дифференциальных операторов конечно-разностными приращениями. Рассмотрим некоторые типовые примеры. Одним из наиболее простых методов является противопотоковый метод, в котором для аппроксимации используются односторонние конечно-разностные приращения

%
\begin{equation}
\label{eq:equation2_3}
\frac{c_i^{n+1}-c_i^n}{\Delta t} + u\frac{c_i^n-c_{i-1}^{n}}{\Delta x} = 0
\end{equation}
%
Здесь предполагается, что $u\ge0$, а направление задано положительно (Here, it was assumed that u>=0 and the direction). Противопотоковый метод обладает первым порядком аппроксимации по времени и пространству. Информация о противопотоковых методах высокого порядка представлена, например, в [12]. Метод с перешагиванием использует центральные конечные разности по времени и пространству
%
\begin{equation}
\label{eq:equation2_4}
\frac{c_i^{n+1}-c_i^{n-1}}{2\Delta t} + u\frac{c_{i+1}^n-c_{i-1}^{n}}{2\Delta x} = 0
\end{equation}
%
Итоговый метод имеет второй порядок аппроксимации по пространству и времени. Применение более точной аппроксимации пространственной производной может дать высокоточные схемы по пространству и времени. Например, взяв центральные разности по времени и аппроксимацию четвертого порядка производной по $x$ (например, см. [14]), получим
%
\begin{equation}
\label{eq:equation2_5}
\frac{c_i^{n+1}-c_i^{n-1}}{2\Delta t} + u\Big[\frac{4}{3}\frac{c_{i+1}^n-c_{i-1}^n}{2\Delta x}-\frac{1}{3}\frac{c_{i+2}^n-c_{i-2}^n}{4\Delta x}\Big] = 0.
\end{equation}
%
Упомянутые методы являются трехшаговыми по времени, потому требуют использования особой аппроксимации для вычисления первого шага по времени. Примером двухшагового по времени метода, который имеет второй порядок аппроксимации, является метод Лакса"--~Вендроффа
%
\begin{equation}
\label{eq:equation2_6}
\frac{c_i^{n+1}-c_i^n}{\Delta t} + u\frac{c_i^n-c_{i-1}^n}{2\Delta x} - \frac{u^2\Delta t}{2}\frac{c_{i+1}^n-2c_i^n+c_{i-1}^n}{\Delta x^2} = 0,
\end{equation}
%
который может быть  интерпретирован как устойчивая версия (неустойчивой) схемы
%
\begin{equation}
\label{eq:equation2_7}
\frac{c_i^{n+1}-c_i^n}{\Delta t} + u\frac{c_{i+1}^n-c_{i-1}^n}{2\Delta x} = 0,
\end{equation}
%
полученной добавлением численной диссипации в особом виде (например, см. [56]). Общеизвестно, что устойчивость этих методов зависит в основном от параметра $C=u\Delta t/\Delta x$, также известного как число Куранта. Основное условие для устойчивости это, фактически, $\left|C\right|\le1$, которое также известно как условие Куранта"--~Фридрихса"--~Леви (КФЛ) (см. [10]).

Лагранжевые и полулагранжевые методы, в свою очередь, используют характерную особенность уравнения переноса, а именно представление точного решения через начальные данные. В частности, рассмотрев без потери общности случай $u\ge0$, можно обнаружить, что имеют место два следующих уравнения
%
\begin{equation}
\label{eq:equation2_8}
\begin{split}
c (x_i, t^n) & = c_0(x_i - un\Delta t) {} \\
		     & {} = c_0(x_i + u\Delta t - u(n+1)\Delta t) = c(x_i + u\Delta t, t^{n+1})
\end{split}
\end{equation}
%
%
\begin{equation}
\label{eq:equation2_9}
\begin{split}
c (x_i, t^{n+1}) & = c_0(x_i - u(n+1)\Delta t) {} \\
& {} = c_0(x_i - u\Delta t - un\Delta t) = c(x_i - u\Delta t, t^{n})
\end{split}
\end{equation}
%
Уравнение \eqref{eq:equation2_9} является основой для чистых лагранжевых методов. Особая природа точного решения уравнения \eqref{eq:equation2_1} позволяет использовать информацию о решении в точке сетки в момент времени $n$, чтобы вывести значение решения в момент времени $n+1$ в точках сетки, которые \textit{переместились с потоком}. В результате того, что сетку необходимо менять на каждом временном шаге, практическое приложение лагранжевых методов неэффективно и данные методы никогда не становились действующими (operational) инструментами в прогнозе погоды или крупномасштабных атмосферных симуляциях.

Уравнение \eqref{eq:equation2_10} обеспечивает основу для полулагранжевого метода. Вновь используется особая природа точного решения \eqref{eq:equation2_1}, чтобы выразить значение решения в узлах сетки на временном шаге $n+1$ через значения решения на временном шаге $n$ в тех узлах сетки, которые \textit{будут перенесены потоком} на вычислительную сетку за один временной шаг.
Тот факт, что сетка не изменяется во времени, имеет практическое преимущество, которое является одной из фундаментальных причин для гораздо более широкого использования полулагранжевых методов, нежели чисто лагранжевых. Дискретное определение полулагранжевого метода может быть получено из уравнения \eqref{eq:equation2_10} (\textbf{ТУТ ЯВНАЯ ОШИБКА, видимо имеется ввиду некоторое уравнение представленное выше}) как
%
\begin{equation}
\label{eq:equation2_10}
c_i^{n+1} = c_{i-u\frac{\Delta t}{\Delta x}}^{n} = c_{i-k-\alpha}^n \quad u\frac{\Delta t}{\Delta x} = k + \alpha \quad k = \Big[u\frac{\Delta t}{\Delta x}\Big].
\end{equation}
%

$k$ and $\alpha$ часто называют целым и дробным числами Куранта, соответственно. Выражение $c_{i-k-\alpha}^n$ может быть интерпретировано как значение, полученное из приближенных значений $c^n$ в точке $i\Delta x - u\Delta t$ с использованием некоторой интерполяционной процедуры. Применив линейную интерполяцию, можно сразу получить два интересных факта
%
\begin{equation}
\label{eq:equation2_11}
c_i^{n+1} = \alpha c_{i-k-1}^{n} + (1-\alpha)c_{i-k}^n.
\end{equation}
%
Во первых, если $C = u\Delta t/\Delta x < 1$, тогда имеем в \eqref{eq:equation2_11} $k=0$, $C=\alpha$ и  легко увидеть, что итоговый метод идентичен противопотоковому методу \eqref{eq:equation2_3}. Более того, ясно, что \eqref{eq:equation2_11} выполняется для любого значения числа Куранта и что, поскольку значения решения на новом временном слое $n+1$ получены с использованием линейной интерполяции значений на временном слое $n$ с неотрицательными коэффициентами, выполняется дискретный принцип максимума, т. е.
%
\begin{equation}
\label{eq:equation2_12}
\min_i c_i^0 \le \min_i c_i^n \le \max_i c_i^n \le \max_i c_i^0
\end{equation}
%
для любого $n$. Это также подразумевает устойчивость в максимум-норме для произвольного числа Куранта. Таким образом, по крайней мере в простом случае, полулагранжевый метод, очевидно, имеет большое преимущество над рассмотренными ранее эйлеровыми методами, поскольку отсутствует условие устойчивости, ограничивающее выбор временного шага.

Полулагранжевый метод может быть легко обобщен на многомерный случай. Рассмотрим поле постоянных скоростей $\mathbf{u}\in\mathbf{R}^d$ и начальное условие $c_0(x), x\in\mathbf{R}^d$. Тогда многомерное линейное уравнение адвекции имеет вид
%
\begin{equation}
\label{eq:equation2_13}
\frac{\partial{c}}{\partial{t}} + \mathbf{u} \cdot \nabla c = 0.
\end{equation}
%
Как и в одномерном случае, аналитическое решение представимо в виде
%
\begin{equation}
\label{eq:equation2_14}
c(\mathbf{x}, t) = c_0(\mathbf{x} - \mathbf{u}t),
\end{equation}
%
и полулагранжевый метод может быть выведен как и в одномерном случае, лишь заменив одномерную интерполяцию на многомерную.
	
В более общем случае, когда поле скоростей $\mathbf{u} (\mathbf{x},t)\in\mathbf{R}^d$ зависит от пространства и времени, имеем
%
\begin{equation}
\label{eq:equation2_15}
\frac{dc}{dt}=\frac{\partial{c}}{\partial{t}} + \mathbf{u}(\mathbf{x}, t) \cdot \nabla c = 0.
\end{equation}
%
Здесь была введена обычная запись $dc/dt$ для обозначения лагранжевой производной. Полагая, для поля скоростей верны некоторые предположения о непрерывности (оно должно быть непрерывным по Липшицу, например, см. [56]), можно доказать, что существует функция линий тока или характеристическая функция. Они определены как решения $\mathbf{X}(t;s, \mathbf{x})$ обыкновенных дифференциальных уравнений
%
\begin{equation}
\label{eq:equation2_16}
\frac{d}{dt}\mathbf{X}(t;s,\mathbf{x})=\mathbf{u}(\mathbf{X}(t; s, \mathbf{x}), t)
\end{equation}
%
с начальным условием в момент времени $s$, заданным как $\mathbf{X}(t;s,\mathbf{x})=\mathbf{x}$. Для гладких начальных данных по цепному правилу доказуемо, что
%
\begin{equation}
\label{eq:equation2_17}
c(\mathbf{x}, t) = c_0(\mathbf{X}(0;t,\mathbf{x})).
\end{equation}
%
Это показывает, что доказательство, аналогичное упомянутому, справедливо для численного метода основанного на полулагранжевом подходе, однако при условии, что получено численное решение уравнения \eqref{eq:equation2_16}. Таким образом, подводя итог, можно сказать, что, используя формулу \eqref{eq:equation2_17}, полулагранжевые методы сводят аппроксимацию уравнения переноса \eqref{eq:equation2_15} к следующим ключевым шагам:
\begin{itemize}
	\item на заданном слое по времени $n$, для каждой точки сетки $x$ вычислить приближенное решение \eqref{eq:equation2_16} для определения оценки $\mathbf{X}^*(t^n;t^{n+1}, \mathbf{x})$
	\item вычислить аппроксимацию уравнения \eqref{eq:equation2_17} путем интерполяции значений в узлах сетки на временном слое $n$ в точках $\mathbf{X}^*(t^n;t^{n+1}, \mathbf{x})$.
\end{itemize}
Это подразумевает что решение ДУЧП \eqref{eq:equation2_15} сведено к решению большого набора взаимно независимых ОДУ и многомерной интерполяции. Для каждого из этих шагов доступен ряд классических и хорошо изученных методов.
\newpage
\chapter*{Глава 3. Роль адвекции в потоках геофизических масштабов} \label{chapt_3}
Уравнения Эйлера во вращающейся системе координат могут быть записаны как
%
\begin{align}
\label{eq:equation3_1}
\frac{d\rho}{dt}&=-\rho\nabla\cdot\mathbf{u}\\
\label{eq:equation3_2}
\frac{d\mathbf{u}}{dt}&=-\frac{1}{\rho}\nabla p - 2 \mathbf{\Omega} \times \mathbf{u} - \nabla \Phi\\
\label{eq:equation3_3}
c_v\frac{dT}{dt}&=-p\nabla\cdot\mathbf{u}.
\end{align}
%
Для крупномасштабного атмосферного движения, горизонтальный пространственный масштаб $L=\mathcal{O}(10^7)m$ намного больше, чем вертикальный масштаб $D=\mathcal{O}(10^4)m$. Вследствие этого гидростатическое допущение является хорошей аппроксимацией (см. например, [24], [49] касательно полного вывода масштабного анализа). Более того, многие ключевые динамические особенности решения полной системы учитываются упрощенными моделями, которые могут быть получены при использовании баротропического допущения $p=p(\rho)$ и при  рассмотрении вертикального среднего уравнений в отношении однородного слоя жидкости переменной глубины. Данное допущение снова основано на том факте, что $L >> D$ и это приводит нас к двумерной модели, также известной как "уравнения мелкой воды"
%
\begin{equation}
\label{eq:equation3_4}
\frac{dh}{dt}=-h\nabla \cdot \mathbf{v}
\end{equation}
%
%
\begin{equation}
\label{eq:equation3_5}
\frac{d\mathbf{v}}{dt}=-g\nabla h - f\mathbf{k}\times \mathbf{v}.
\end{equation}
%
где $f=2\Omega\sin\theta$, $\theta$ это широта, а орографический профиль взят за константу. Если взять ротор уравнения количества движения и скомбинировать результат с уравнением неразрывности, то получим так называемое уравнение потенциальной завихренности
%
\begin{equation}
\label{eq:equation3_6}
\frac{d}{dt}\Big(\frac{\zeta + f}{h}\Big) = 0.
\end{equation}
%
Общепризнанно, что уравнение \eqref{eq:equation3_6} является решением большинства крупномасштабных волн (волны Россби) которые представляют собой огромные метеорологические системы. Дальнейшее упрощение может даже привести к квазигеострофической модели, в которой разновидность уравнения \eqref{eq:equation3_6} является, по сути, прогнозирующим уравнением, а все остальные эволюционные уравнения заменены на приближенные балансовые соотношения. Начиная с основополагающей работы [8], ранние модели численного предсказания погоды (см., например, [24], [73]) использовали данную упрощенную систему по ряду причин вычислительного характера. Точное решение уравнения \eqref{eq:equation3_6} (или решение эквивалентных формулировок вихревой адвекции) суть одна из неотъемлемых особенностей для моделей, предназначенных для симуляции крупномасштабных атмосферных потоков. Именно в данном контексте, был впервые разработан полулагранжевый подход и, спустя годы, стал распространённым методом численного моделирования.

Необходимо отметить, что, несмотря на концептуальные причины, существовало большое количество практических стимулов к успешному применению полулагранжевых методов в метеорологии. На стандартных декартовых сетках при использовании сферических координат, сближение меридианов на полюсах приводило к очень большим числам Куранта, даже при достаточно разреженной (в остальной области) вычислительной сетке. Данная особенность, известная также как "полюсная проблема", приводит к необходимости специально обрабатывать полюсные "шапочки" (pole caps) во многих глобальных моделях. Полулагранжевые методы, будучи безусловно устойчивыми, не представляют никаких особенных проблем в этом отношении. Однако, указанные методы по-прежнему требуют подходящего подхода к координатной сингулярности при расчете траекторий и при к интерполяции в ячейках, близких к полюсам.
\chapter*{Глава 4. Историческое развитие полулагранжевых методов} \label{chapt_4}
Первой статьей, посвященной методам для уравнения переноса и методам, которые применяют подход распространения вдоль характеристик, является хорошо известная работа Куранта, Айзексона и Риз [11] по численному решению гиперболических систем, а в метеорологической литературе, статья о методике графического интегрирования Р. Фьортофта [20]. Более детальный анализ был проведен Виин"=Нильсеном в [73]. В этой статье, снова внимание было уделено баротропическому вихревому уравнению, которое представляло собой единственную модель с помощью которой в то время мог быть получен практически значимый численный прогноз. Затем этот метод был применен в [48], а затем переформулирован в тот вид, который весьма похож на тот, что применяется сегодня. Первое применение к простейшей модели уравнения переноса было представлено в [28], а первое подтверждение того, что большие шаги по времени могут быть использованы в методе без появления численной неустойчивости решения, было найдено Дж. Сойером в [63]. Дальнейшая разработка метода характеристик проводилась в [1], в тоже время, дальнейший анализ и тесты в метеорологической литературе проводились в [30], [12]. Как отмечалось ранее, одна из особенностей, которая на сегодняшний день наиболее тесно ассоциируется с полулагранжевыми методами, а именно свойство сохранять устойчивость при любом числе Куранта, в то время не являлась столь очевидной. (см., например, [30], [53]).

В ранних восьмидесятых, разнообразные публикации упрочнили роль полулагранжевых методов (а также методов, основанных на характеристиках) в разных подходах к моделированию. В области конечных элементов, огромное влияние оказали статьи Пирону [50] и Дугласа [27]. В области конечно-объемных подходов, Д. Моретти в [41] была предложена разновидность метода характеристик. Также К. В. Мортоном в [42], [45] была введена концепция характеристических методов Галеркина. В контексте метеорологии, ключевыми являются работы [59], [60] A. Роберта, в которых был пересмотрен численный метод Сойера и затем объединен с техникой полу"=неявной дискретизации, таким образом демонстрируя полный потенциал полулагранжевых методов с точки зрения использования гораздо более больших шагов по времени. Лежащая в основе полулагранжевого подхода безусловная сходимость для линейной и квадратичной интерполяции на декартовых сетках была доказана Дж. Р. Бейтсом и А. Макдональдом в [3]. Анализ устойчивости кубической сплайн интерполяции на декартовых сетках из [53] был расширен А. Станифортом и К. Темпертоном в [52] на случай для чисел Куранта больше единицы. Двухшаговые схемы были предложены А. Макдональдом и Дж. Р. Бейтсом в [38], а также А. Станифортом и К. Темпертоном в [70]. Связка полулагранжевых методов с методами спектрального анализа для простейших уравнений движения была впервые предложена Г. Ритчи в [57], [58]. Общая устойчивость и анализ сходимости для случая адвекции с переменными коэффициентами была представлена в [16] в контексте конечно-элементной формулировки.

В 2000 году ситуация такова, что ряд оперативных центров используют полулагранжевые модели для своих дневных прогнозов. Среди этих моделей можно выделить, например, IFS (Integrated Forecast System) в ECMWF (European Centre for Medium-Range Weather Forecasts) [71], GEM (Global Environmental Multiscale Model) модель в RPN Canada (The Recherche en Prévision Numérique) [9] и Universal Model в Met Office [72].
\chapter*{Глава 5. Практика полулагранжевых методов} \label{chapt_5}
Как было показано в разделе 2, полулагранжевые методы сводят аппроксимацию уравнения \eqref{eq:equation2_15} к следующим двум ключевым этапам:
\begin{itemize}
	\item на заданном слое по времени $n$, для каждой точки сетки $x$ вычислить приближенное решение \eqref{eq:equation2_16} для определения оценки $\mathbf{X}^*(t^n;t^{n+1}, \mathbf{x})$
	\item вычислить аппроксимацию уравнения \eqref{eq:equation2_17} путем интерполяции значений в узлах сетки на временном слое $n$ в точках $\mathbf{X}^*(t^n;t^{n+1}, \mathbf{x})$.
\end{itemize}
Ниже обсудим как образом можно получить решение на каждом их этих этапов и при этом достичь великолепной точности и эффективности в итоговом численном методе.
\section*{Подходы к аппроксимации траекторий} \label{sect5_1}
\section*{Методы интерполяции} \label{sect5_2}
\chapter*{Глава 6. Численные эксперименты: одно- и двумерный пассивный перенос} \label{chapt_6}
\section*{Одномерная адвекция} \label{sect6_1}
\section*{Двумерная адвекция} \label{sect6_2}
\section*{Сравнение с простыми эйлеровыми схемами} \label{sect6_3}
\chapter*{Глава 7. Теория полулагранжевых методов: анализ сходимости и устойчивости} \label{chapt_7}
\chapter*{Глава 8. Полулагранжевые методы против метода характеристик: полунеявные полулагранжевые методы
	 для условий с малым числом Фруда} \label{chapt_8}
\chapter*{Глава 9. Консервативные(mass conservative) и векторные (flux form) полулагранжевые методы} \label{chapt_9}
\newpage
\chapter*{Глава 10. Выводы} \label{chapt_10}
Был представлен полулагранжевый метод решения уравнения переноса, а также рассмотрено его развитие в контексте атмосферного моделирования за последние 50 лет. Были рассмотрены его простейшие свойства и приведен обзор базовых теоретических свойств. В частности, предпринята попытка применить методы, разработанные для атмосферного моделирования, в более широкой перспективе современных методов конечных объемов и разностей, вместе с набросками предложенными К. В. Мортоном в [43]. Возможно, осмысление сильно выраженных сходств между современными, полностью многомерными адвективными схемами поможет утихомирить многочисленные дебаты относительно достоинств эйлеровых и лагранжевых схем.
%\newpage